<p-toast></p-toast>

<h1 class="text-center">Liste des produits</h1>

<div class="flex justify-content-between align-items-center mb-4">
  <p-button label="CrÃ©er produit" (onClick)="onCreate()" />
  <a routerLink="/cart" class="cart-link">
    <p-button icon="pi pi-shopping-cart" severity="secondary">
      <span
        pBadge
        [value]="cartService.getTotalItems()"
        severity="danger"
      ></span>
    </p-button>
  </a>
</div>

<p-dataView #dv [value]="products()">
  <ng-template pTemplate="list" let-products>
    @for (product of products; track product) {
    <p-card class="block mb-2">
      <div class="flex align-items-center">
        <img [src]="product.image" [alt]="product.name" class="product-image" />
        <div class="ml-3">
          <span class="font-medium text-secondary text-sm">{{
            product.category
          }}</span>
          <div class="text-lg font-medium text-900 mt-2">
            {{ product.name }}
          </div>
          <div class="text-sm text-500 mt-2">{{ product.description }}</div>
          <div class="text-xl font-bold text-900 mt-2">
            {{ product.price | currency : "EUR" }}
          </div>
        </div>
      </div>

      <ng-template pTemplate="footer">
        <div class="flex gap-3 mt-1">
          <p-button
            label="Ajouter au panier"
            icon="pi pi-shopping-cart"
            (onClick)="addToCart(product)"
          />
          <p-button
            label="Modifier"
            severity="secondary"
            (onClick)="onUpdate(product)"
          />
          <p-button
            label="Supprimer"
            severity="danger"
            (onClick)="onDelete(product)"
          />
        </div>
      </ng-template>
    </p-card>
    }
  </ng-template>
</p-dataView>

<p-dialog
  [(visible)]="isDialogVisible"
  [style]="{ width: '50vw' }"
  header="Ajout/Edition produit"
>
  @if (editedProduct()) {
  <app-product-form
    [product]="editedProduct()!"
    (save)="onSave($event)"
    (cancel)="onCancel()"
  />
  }
</p-dialog>
